import socket
import threading
from queue import Queue

class PortScanner:
    def __init__(self, target_ip, start_port=1, end_port=1024):
        self.target_ip = target_ip
        self.start_port = start_port
        self.end_port = end_port
        self.open_ports = []
        self.queue = Queue()
        self.lock = threading.Lock()

    def scan_port(self):
        while not self.queue.empty():
            port = self.queue.get()
            try:
                sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
                sock.settimeout(1)
                result = sock.connect_ex((self.target_ip, port))
                if result == 0:
                    with self.lock:
                        self.open_ports.append(port)
                        print(f"Port {port} is open")
                sock.close()
            except:
                pass
            self.queue.task_done()

    def scan(self):
        print(f"Scanning {self.target_ip} from port {self.start_port} to {self.end_port}...")
        for port in range(self.start_port, self.end_port + 1):
            self.queue.put(port)

        threads = []
        for _ in range(100):  # Use 100 threads for speed
            thread = threading.Thread(target=self.scan_port)
            thread.start()
            threads.append(thread)

        self.queue.join()
        for thread in threads:
            thread.join()

        print(f"Scan complete. Open ports: {self.open_ports}")
        return self.open_ports